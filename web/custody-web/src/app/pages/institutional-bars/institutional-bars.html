<div class="institutionalBarsPage">
  <div class="content">

    <!-- Header (centered) -->
    <div class="pageHeader">
      <h2>Allocated Bars</h2>
      <p>View your allocated physical holdings.</p>

      <div class="pageLinks">
        <a href="/institutional/withdrawals">Go to Withdrawals</a>
        <a href="/my-deposits">Go to Deposits</a>
        <a href="/institutional-bars">Refresh</a>
      </div>
    </div>

    <!-- Status messages -->
    <!-- <p *ngIf="loading" class="muted">Loading…</p>
    <p *ngIf="error" class="errorText">{{ error }}</p> -->

    <!-- Two-column layout -->
    <div class="grid">
      <!-- Left: Available -->
      <div class="panel">
        <h3>Available Bars (select for withdrawal)</h3>

        <div class="tableCard">
          <div class="tableWrap">
            <table>
              <thead>
                <tr>
                  <th style="width:44px;"></th>
                  <th>Serial</th>
                  <th>Metal</th>
                  <th class="num">Weight (kg)</th>
                  <th>Vault</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let b of available">
                  <td>
                    <input
                      type="checkbox"
                      [checked]="isSelected(b.id)"
                      (change)="toggle(b.id)"
                    />
                  </td>
                  <td class="mono">{{ b.serial }}</td>
                  <td>{{ b.metal?.code ?? '-' }}</td>
                  <td class="num mono">{{ b.weight_kg }}</td>
                  <td>{{ b.vault ?? '-' }}</td>
                </tr>

                <tr *ngIf="available.length === 0">
                  <td colspan="5" class="emptyRow">No available bars.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="summary">
          <div><b>Selected:</b> {{ selected.size }}</div>
          <div><b>Total selected (kg):</b> {{ selectedTotalKg() }}</div>

          <button
            class="btn primary"
            (click)="submitAllocatedWithdrawal()"
            [disabled]="submitting || selected.size === 0"
          >
            {{ submitting ? 'Submitting…' : 'Request Allocated Withdrawal' }}
          </button>

          <p *ngIf="submitError" class="errorText" style="margin-top:10px;">
            {{ submitError }}
          </p>
          <p *ngIf="submitSuccess" class="successText" style="margin-top:10px;">
            {{ submitSuccess }}
          </p>
        </div>
      </div>

      <!-- Right: All -->
      <div class="panel">
        <h3>All Bars (status view)</h3>

        <div class="tableCard">
          <div class="tableWrap">
            <table>
              <thead>
                <tr>
                  <th>Serial</th>
                  <th>Status</th>
                  <th class="num">Weight (kg)</th>
                  <th class="num">Reserved By</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let b of all">
                  <td class="mono">{{ b.serial }}</td>
                  <td>{{ b.status }}</td>
                  <td class="num mono">{{ b.weight_kg }}</td>
                  <td class="num mono">{{ b.reserved_by_withdrawal_id ?? '-' }}</td>
                </tr>

                <tr *ngIf="all.length === 0">
                  <td colspan="4" class="emptyRow">No bars found.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <button class="btn" style="margin-top:12px;" (click)="refresh()">
          Refresh
        </button>
      </div>
    </div>

    <div style="margin-top:16px; text-align:center;">
      <a href="/institutional/withdrawals">Go to Withdrawals</a>
    </div>

  </div>
</div>

